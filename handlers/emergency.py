from aiogram import Router, F
from aiogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton
from config import HOTLINES

router = Router()

def get_emergency_kb():
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üö® –°–∫–æ—Ä–∞—è –ø–æ–º–æ—â—å (–ø–æ —à–∞–≥–∞–º)", callback_data="emergency_script")],
        [InlineKeyboardButton(text="üßò –¢–µ—Ö–Ω–∏–∫–∞ 5-4-3-2-1", callback_data="technique_54321")],
        [InlineKeyboardButton(text="üå¨Ô∏è –î—ã—Ö–∞–Ω–∏–µ 4-7-8", callback_data="breathing_478")],
        [InlineKeyboardButton(text="üìû –ì–æ—Ä—è—á–∏–µ –ª–∏–Ω–∏–∏", callback_data="hotlines")],
        [InlineKeyboardButton(text="üè† –ú–µ–Ω—é", callback_data="menu")]
    ])

def emergency_script():
    return (
        "üö® <b>–°–∫—Ä–∏–ø—Ç ¬´–°–∫–æ—Ä–æ–π –ø–æ–º–æ—â–∏¬ª –ø—Ä–∏ –ø–∞–Ω–∏—á–µ—Å–∫–æ–π –∞—Ç–∞–∫–µ</b>\n\n"
        "<b>–®–ê–ì 1: –ü–†–ò–ó–ù–ê–ù–ò–ï</b>\n"
        "–°–∫–∞–∂–∏—Ç–µ —Å–µ–±–µ: <i>¬´–≠—Ç–æ –ø–∞–Ω–∏—á–µ—Å–∫–∞—è –∞—Ç–∞–∫–∞. –û–Ω–∞ –ø—Ä–æ–π–¥—ë—Ç. –Ø –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.¬ª</i>\n"
        "üí° –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç: –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ —Å–Ω–∏–∂–∞–µ—Ç —Å—Ç—Ä–∞—Ö —Å—Ç—Ä–∞—Ö–∞.\n\n"
        
        "<b>–®–ê–ì 2: –ó–ê–ó–ï–ú–õ–ï–ù–ò–ï</b>\n"
        "–ù–∞–π–¥–∏—Ç–µ 5 –≤–µ—â–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –≤–∏–¥–∏—Ç–µ –≤–æ–∫—Ä—É–≥:\n"
        "‚Ä¢ –û–∫–Ω–æ / —Å—Ç–µ–Ω–∞ / —Ç–µ–ª–µ—Ñ–æ–Ω / –∫–Ω–∏–≥–∞ / —Å—Ç–æ–ª\n"
        "–ù–∞–∑–æ–≤–∏—Ç–µ –∏—Ö –≤—Å–ª—É—Ö –∏–ª–∏ –ø—Ä–æ —Å–µ–±—è.\n"
        "üí° –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç: –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –º–æ–∑–≥ —Å –ø–∞–Ω–∏–∫–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å.\n\n"
        
        "<b>–®–ê–ì 3: –î–´–•–ê–ù–ò–ï</b>\n"
        "–î—ã—à–∏—Ç–µ –ø–æ —Å—Ö–µ–º–µ 4-7-8:\n"
        "‚Ä¢ –í–¥–æ—Ö —á–µ—Ä–µ–∑ –Ω–æ—Å ‚Äî 4 —Å–µ–∫—É–Ω–¥—ã (—Å—á–∏—Ç–∞–π—Ç–µ –ø—Ä–æ —Å–µ–±—è)\n"
        "‚Ä¢ –ó–∞–¥–µ—Ä–∂–∫–∞ ‚Äî 7 —Å–µ–∫—É–Ω–¥\n"
        "‚Ä¢ –í—ã–¥–æ—Ö —á–µ—Ä–µ–∑ —Ä–æ—Ç ‚Äî 8 —Å–µ–∫—É–Ω–¥\n"
        "‚Ä¢ –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ 3-4 —Ä–∞–∑–∞\n"
        "üí° –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç: –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–∞—Ä–∞—Å–∏–º–ø–∞—Ç–∏—á–µ—Å–∫—É—é –Ω–µ—Ä–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É.\n\n"
        
        "<b>–®–ê–ì 4: –§–ò–ó–ò–ß–ï–°–ö–ò–ô –ö–û–ù–¢–ê–ö–¢</b>\n"
        "‚Ä¢ –ù–∞–¥–∞–≤–∏—Ç–µ –ª–∞–¥–æ–Ω—å—é –Ω–∞ –ª–∞–¥–æ–Ω—å (10 —Å–µ–∫—É–Ω–¥)\n"
        "‚Ä¢ –ò–ª–∏ –ø–æ—Ç—Ä–æ–≥–∞–π—Ç–µ —á—Ç–æ-—Ç–æ —Ö–æ–ª–æ–¥–Ω–æ–µ (—Å—Ç–∞–∫–∞–Ω –≤–æ–¥—ã, –º–µ—Ç–∞–ª–ª)\n"
        "‚Ä¢ –ò–ª–∏ —Å–æ–∂–º–∏—Ç–µ –∫—É–ª–∞–∫–∏ –∏ —Ä–∞–∑–æ–∂–º–∏—Ç–µ 5 —Ä–∞–∑\n"
        "üí° –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç: —Ç–µ–ª–µ—Å–Ω—ã–µ –æ—â—É—â–µ–Ω–∏—è –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –≤ ¬´–∑–¥–µ—Å—å –∏ —Å–µ–π—á–∞—Å¬ª.\n\n"
        
        "<b>–®–ê–ì 5: –°–ê–ú–û–†–ê–ó–ì–û–í–û–†</b>\n"
        "–°–∫–∞–∂–∏—Ç–µ —Å–µ–±–µ:\n"
        "‚Ä¢ <i>¬´–≠—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ¬ª</i>\n"
        "‚Ä¢ <i>¬´–Ø –ø–µ—Ä–µ–∂–∏–≤–∞–ª(–∞) —ç—Ç–æ —Ä–∞–Ω—å—à–µ ‚Äî —Å–ø—Ä–∞–≤–ª—é—Å—å —Å–Ω–æ–≤–∞¬ª</i>\n"
        "‚Ä¢ <i>¬´–ú–æ—ë —Ç–µ–ª–æ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —Å—Ç—Ä–µ—Å—Å ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ¬ª</i>\n\n"
        
        "<b>‚ö†Ô∏è –ö–û–ì–î–ê –û–ë–†–ê–©–ê–¢–¨–°–Ø –ö –í–†–ê–ß–£:</b>\n"
        "‚Ä¢ –ï—Å–ª–∏ –ø—Ä–∏—Å—Ç—É–ø –¥–ª–∏—Ç—Å—è –±–æ–ª—å—à–µ 20 –º–∏–Ω—É—Ç –±–µ–∑ —É–ª—É—á—à–µ–Ω–∏—è\n"
        "‚Ä¢ –ï—Å–ª–∏ –µ—Å—Ç—å –±–æ–ª—å –≤ –≥—Ä—É–¥–∏, –æ—Ç–¥–∞—é—â–∞—è –≤ —Ä—É–∫—É –∏–ª–∏ —á–µ–ª—é—Å—Ç—å\n"
        "‚Ä¢ –ï—Å–ª–∏ –≤—ã —Ç–µ—Ä—è–µ—Ç–µ —Å–æ–∑–Ω–∞–Ω–∏–µ –∏–ª–∏ —á—É–≤—Å—Ç–≤—É–µ—Ç–µ –æ–Ω–µ–º–µ–Ω–∏–µ –ª–∏—Ü–∞/—Ä—É–∫"
    )

def technique_54321():
    return (
        "üßò <b>–¢–µ—Ö–Ω–∏–∫–∞ –∑–∞–∑–µ–º–ª–µ–Ω–∏—è 5-4-3-2-1</b>\n\n"
        "<b>5</b> ‚Äî –ù–∞–∑–æ–≤–∏—Ç–µ <b>5 –≤–µ—â–µ–π</b>, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã <b>–≤–∏–¥–∏—Ç–µ</b> –≤–æ–∫—Ä—É–≥ —Å–µ–±—è:\n"
        "–ü—Ä–∏–º–µ—Ä: —Å—Ç–æ–ª, –ª–∞–º–ø–∞, –æ–∫–Ω–æ, –∫–Ω–∏–≥–∞, —Ç–µ–ª–µ—Ñ–æ–Ω.\n"
        "üîπ –°–æ—Å—Ä–µ–¥–æ—Ç–æ—á—å—Ç–µ—Å—å –Ω–∞ –∫–∞–∂–¥–æ–π –≤–µ—â–∏ 2-3 —Å–µ–∫—É–Ω–¥—ã.\n\n"
        
        "<b>4</b> ‚Äî –ù–∞–∑–æ–≤–∏—Ç–µ <b>4 –≤–µ—â–∏</b>, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –º–æ–∂–µ—Ç–µ <b>–ø–æ—Ç—Ä–æ–≥–∞—Ç—å</b>:\n"
        "–ü—Ä–∏–º–µ—Ä: —Ç–∫–∞–Ω—å –æ–¥–µ–∂–¥—ã, —Å—Ç—É–ª, –≤–æ–ª–æ—Å—ã, —Å—Ç–æ–ª.\n"
        "üîπ –ü–æ—á—É–≤—Å—Ç–≤—É–π—Ç–µ —Ç–µ–∫—Å—Ç—É—Ä—É –∫–∞–∂–¥–æ–π –≤–µ—â–∏.\n\n"
        
        "<b>3</b> ‚Äî –ù–∞–∑–æ–≤–∏—Ç–µ <b>3 –≤–µ—â–∏</b>, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –º–æ–∂–µ—Ç–µ <b>—É—Å–ª—ã—à–∞—Ç—å</b>:\n"
        "–ü—Ä–∏–º–µ—Ä: —Ç–∏–∫–∞–Ω—å–µ —á–∞—Å–æ–≤, —à—É–º –∑–∞ –æ–∫–Ω–æ–º, —Å–≤–æ—ë –¥—ã—Ö–∞–Ω–∏–µ.\n"
        "üîπ –ü—Ä–∏—Å–ª—É—à–∞–π—Ç–µ—Å—å –∫ –∫–∞–∂–¥–æ–º—É –∑–≤—É–∫—É.\n\n"
        
        "<b>2</b> ‚Äî –ù–∞–∑–æ–≤–∏—Ç–µ <b>2 –≤–µ—â–∏</b>, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –º–æ–∂–µ—Ç–µ <b>–ø–æ–Ω—é—Ö–∞—Ç—å</b>:\n"
        "–ü—Ä–∏–º–µ—Ä: –∫–æ—Ñ–µ, –¥—É—Ö–∏, —Å–≤–µ–∂–∏–π –≤–æ–∑–¥—É—Ö.\n"
        "üîπ –ï—Å–ª–∏ —Ä—è–¥–æ–º –Ω–µ—Ç –∑–∞–ø–∞—Ö–æ–≤ ‚Äî –≤—Å–ø–æ–º–Ω–∏—Ç–µ –ª—é–±–∏–º—ã–π.\n\n"
        
        "<b>1</b> ‚Äî –ù–∞–∑–æ–≤–∏—Ç–µ <b>1 –≤–µ—â—å</b>, –∫–æ—Ç–æ—Ä—É—é –≤—ã –º–æ–∂–µ—Ç–µ <b>–ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å</b>:\n"
        "–ü—Ä–∏–º–µ—Ä: –≤–æ–¥—É, –∂–≤–∞—á–∫—É, –º—è—Ç–Ω—É—é –∫–æ–Ω—Ñ–µ—Ç—É.\n\n"
        
        "üí° <b>–ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</b>\n"
        "–¢–µ—Ö–Ω–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –º–æ–∑–≥ —Å —Ç—Ä–µ–≤–æ–∂–Ω—ã—Ö –º—ã—Å–ª–µ–π –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –æ—â—É—â–µ–Ω–∏—è. "
        "–≠—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–∞—Å –≤ ¬´–∑–¥–µ—Å—å –∏ —Å–µ–π—á–∞—Å¬ª –∏ —Å–Ω–∏–∂–∞–µ—Ç –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –ø–∞–Ω–∏–∫–∏.\n\n"
        
        "‚è±Ô∏è <b>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</b> 1-2 –º–∏–Ω—É—Ç—ã.\n"
        "üîÅ <b>–ü–æ–≤—Ç–æ—Ä—è–π—Ç–µ</b>, –ø–æ–∫–∞ –Ω–µ –ø–æ—á—É–≤—Å—Ç–≤—É–µ—Ç–µ –æ–±–ª–µ–≥—á–µ–Ω–∏–µ."
    )

def breathing_478():
    return (
        "üå¨Ô∏è <b>–î—ã—Ö–∞–Ω–∏–µ 4-7-8 (¬´–†–µ–ª–∞–∫—Å–∏—Ä—É—é—â–µ–µ –¥—ã—Ö–∞–Ω–∏–µ¬ª)</b>\n\n"
        "<b>–ü–û–î–ì–û–¢–û–í–ö–ê:</b>\n"
        "‚Ä¢ –°—è–¥—å—Ç–µ –∏–ª–∏ –ª—è–≥—Ç–µ —É–¥–æ–±–Ω–æ\n"
        "‚Ä¢ –ü–æ–ª–æ–∂–∏—Ç–µ –∫–æ–Ω—á–∏–∫ —è–∑—ã–∫–∞ –∑–∞ –≤–µ—Ä—Ö–Ω–∏–µ –ø–µ—Ä–µ–¥–Ω–∏–µ –∑—É–±—ã (—É–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ —Ç–∞–º –≤—Å—ë –≤—Ä–µ–º—è)\n"
        "‚Ä¢ –í—ã–¥–æ—Ö–Ω–∏—Ç–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —á–µ—Ä–µ–∑ —Ä–æ—Ç (—Å —à—É–º–æ–º)\n\n"
        
        "<b>–¶–ò–ö–õ:</b>\n"
        "1Ô∏è‚É£ <b>–ó–∞–∫—Ä–æ–π—Ç–µ —Ä–æ—Ç.</b> –í–¥–æ—Ö–Ω–∏—Ç–µ <b>—Ç–∏—Ö–æ —á–µ—Ä–µ–∑ –Ω–æ—Å</b> –Ω–∞ —Å—á—ë—Ç <b>4</b>.\n"
        "   (1-2-3-4)\n\n"
        
        "2Ô∏è‚É£ <b>–ó–∞–¥–µ—Ä–∂–∏—Ç–µ –¥—ã—Ö–∞–Ω–∏–µ</b> –Ω–∞ —Å—á—ë—Ç <b>7</b>.\n"
        "   (1-2-3-4-5-6-7)\n\n"
        
        "3Ô∏è‚É£ <b>–í—ã–¥–æ—Ö–Ω–∏—Ç–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —á–µ—Ä–µ–∑ —Ä–æ—Ç</b> –Ω–∞ —Å—á—ë—Ç <b>8</b> (—Å —à—É–º–æ–º).\n"
        "   (1-2-3-4-5-6-7-8)\n\n"
        
        "4Ô∏è‚É£ <b>–≠—Ç–æ –æ–¥–∏–Ω —Ü–∏–∫–ª.</b> –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –µ—â—ë <b>3 —Ä–∞–∑–∞</b> (–≤—Å–µ–≥–æ 4 —Ü–∏–∫–ª–∞).\n\n"
        
        "üí° <b>–ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</b>\n"
        "–î—ã—Ö–∞–Ω–∏–µ 4-7-8 –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–∞—Ä–∞—Å–∏–º–ø–∞—Ç–∏—á–µ—Å–∫—É—é –Ω–µ—Ä–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É, "
        "–∫–æ—Ç–æ—Ä–∞—è –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ. –£–¥–ª–∏–Ω—ë–Ω–Ω—ã–π –≤—ã–¥–æ—Ö —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç "
        "–º–æ–∑–≥—É: ¬´–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–æ—à–ª–∞¬ª.\n\n"
        
        "‚ö†Ô∏è <b>–í–∞–∂–Ω–æ:</b>\n"
        "‚Ä¢ –ù–µ –¥–µ–ª–∞–π—Ç–µ –±–æ–ª—å—à–µ 4 —Ü–∏–∫–ª–æ–≤ –ø–æ–¥—Ä—è–¥ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏.\n"
        "‚Ä¢ –ï—Å–ª–∏ —á—É–≤—Å—Ç–≤—É–µ—Ç–µ –≥–æ–ª–æ–≤–æ–∫—Ä—É–∂–µ–Ω–∏–µ ‚Äî –∑–∞–º–µ–¥–ª–∏—Ç–µ —Å—á—ë—Ç.\n"
        "‚Ä¢ –°–æ –≤—Ä–µ–º–µ–Ω–µ–º –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 8 —Ü–∏–∫–ª–æ–≤."
    )

@router.message(F.text.in_(['üÜò –ú–Ω–µ –ø–ª–æ—Ö–æ —Å–µ–π—á–∞—Å', 'üÜò –ú–Ω–µ –ø–ª–æ—Ö–æ']))
async def emergency(message: Message):
    await message.answer(
        "üÜò <b>–°–∫–æ—Ä–∞—è –ø–æ–º–æ—â—å</b>\n\n"
        "–í—ã –Ω–µ –æ–¥–Ω–∏. –í–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å:\n\n"
        "üëá –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –≤–∞—Ä–∏–∞–Ω—Ç:",
        reply_markup=get_emergency_kb()
    )

@router.callback_query(F.data == "emergency_script")
async def send_emergency_script(callback):
    await callback.message.answer(emergency_script())
    await callback.answer()

@router.callback_query(F.data == "technique_54321")
async def send_54321(callback):
    await callback.message.answer(technique_54321())
    await callback.answer()

@router.callback_query(F.data == "breathing_478")
async def send_478(callback):
    await callback.message.answer(breathing_478())
    await callback.answer()

@router.callback_query(F.data == "hotlines")
async def send_hotlines(callback):
    text = "üìû <b>–ì–æ—Ä—è—á–∏–µ –ª–∏–Ω–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏:</b>\n\n" + "\n".join(HOTLINES['ru'])
    await callback.message.answer(text)
    await callback.answer()

@router.callback_query(F.data == "menu")
async def back_to_menu(callback):
    from handlers.start import get_main_keyboard
    await callback.message.answer(
        "üè† <b>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</b>",
        reply_markup=get_main_keyboard('ru')
    )
    await callback.answer()
